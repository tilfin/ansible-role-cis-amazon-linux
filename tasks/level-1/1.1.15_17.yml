# Standards: 0.11
---

# 1.1.15 Ensure nodev option set on /dev/shm partition (Scored)
# 1.1.16 Ensure nosuid option set on /dev/shm partition (Scored)
# 1.1.17 Ensure noexec option set on /dev/shm partition (Scored)

- name: Current mounting /dev/shm state
  shell: "mount | grep /dev/shm"
  register: mount_dev_shm
  tags:
    - level-1
    - section-1
    - "1.1.15"
    - "1.1.16"
    - "1.1.17"
    - scored

- name: 1.1.15~17 - Ensure nodev,nosuid,noexec option set on /dev/shm partition
  mount:
    name: "{{ item.mount }}"
    state: mounted
    fstype: "{{ item.fstype }}"
    src: "{{ item.device }}"
    opts: "{{ item.opts }}"
  with_items:
    - { mountpoint: '/dev/shm', device: 'tmpfs', fstype: 'tmpfs', opts: 'rw,nosuid,nodev,noexec,relatime' }
  when: "'tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime)' not in mount_dev_shm.stdout"
  tags:
    - level-1
    - section-1
    - "1.1.15"
    - "1.1.16"
    - "1.1.17"
    - scored
